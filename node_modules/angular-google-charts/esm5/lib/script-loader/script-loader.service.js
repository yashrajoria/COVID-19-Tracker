import { __assign, __decorate, __metadata, __param } from "tslib";
import { Inject, Injectable, LOCALE_ID, NgZone, Optional } from '@angular/core';
import { Observable, of, Subject } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { GOOGLE_CHARTS_CONFIG } from '../models/injection-tokens.model';
import * as i0 from "@angular/core";
import * as i1 from "../models/injection-tokens.model";
var DEFAULT_CONFIG = {
    mapsApiKey: '',
    version: 'current',
    safeMode: false
};
var ScriptLoaderService = /** @class */ (function () {
    function ScriptLoaderService(zone, localeId, config) {
        this.zone = zone;
        this.localeId = localeId;
        this.config = config;
        this.scriptSource = 'https://www.gstatic.com/charts/loader.js';
        this.scriptLoadSubject = new Subject();
        this.config = __assign(__assign({}, DEFAULT_CONFIG), (config || {}));
    }
    /**
     * Checks whether `google.charts` is available.
     *
     * If not, it can be loaded by calling `loadChartPackages`.
     *
     * @returns `true` if `google.charts` is available, `false` otherwise.
     */
    ScriptLoaderService.prototype.isGoogleChartsAvailable = function () {
        if (typeof google === 'undefined' || typeof google.charts === 'undefined') {
            return false;
        }
        return true;
    };
    /**
     * Loads the Google Chart script and the provided chart packages.
     * Can be called multiple times to load more packages.
     *
     * When called without any arguments, this will just load the default package
     * containing the namespaces `google.charts` and `google.visualization` without any charts.
     *
     * @param packages The packages to load.
     * @returns A stream emitting as soon as the chart packages are loaded.
     */
    ScriptLoaderService.prototype.loadChartPackages = function () {
        var _this = this;
        var packages = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            packages[_i] = arguments[_i];
        }
        return this.loadGoogleCharts().pipe(switchMap(function () {
            return new Observable(function (observer) {
                var config = {
                    packages: packages,
                    language: _this.localeId,
                    mapsApiKey: _this.config.mapsApiKey,
                    safeMode: _this.config.safeMode
                };
                google.charts.load(_this.config.version, config);
                google.charts.setOnLoadCallback(function () {
                    _this.zone.run(function () {
                        observer.next();
                        observer.complete();
                    });
                });
            });
        }));
    };
    /**
     * Loads the Google Charts script. After the script is loaded, `google.charts` is defined.
     *
     * @returns A stream emitting as soon as loading has completed.
     * If the google charts script is already loaded, the stream emits immediately.
     */
    ScriptLoaderService.prototype.loadGoogleCharts = function () {
        var _this = this;
        if (this.isGoogleChartsAvailable()) {
            return of(null);
        }
        else if (!this.isLoadingGoogleCharts()) {
            var script = this.createGoogleChartsScript();
            script.onload = function () {
                _this.zone.run(function () {
                    _this.scriptLoadSubject.next();
                    _this.scriptLoadSubject.complete();
                });
            };
            script.onerror = function () {
                _this.zone.run(function () {
                    console.error('Failed to load the google charts script!');
                    _this.scriptLoadSubject.error(new Error('Failed to load the google charts script!'));
                });
            };
        }
        return this.scriptLoadSubject.asObservable();
    };
    ScriptLoaderService.prototype.isLoadingGoogleCharts = function () {
        return this.getGoogleChartsScript() != null;
    };
    ScriptLoaderService.prototype.getGoogleChartsScript = function () {
        var _this = this;
        var pageScripts = Array.from(document.getElementsByTagName('script'));
        return pageScripts.find(function (script) { return script.src === _this.scriptSource; });
    };
    ScriptLoaderService.prototype.createGoogleChartsScript = function () {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = this.scriptSource;
        script.async = true;
        document.getElementsByTagName('head')[0].appendChild(script);
        return script;
    };
    ScriptLoaderService.ctorParameters = function () { return [
        { type: NgZone },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [GOOGLE_CHARTS_CONFIG,] }, { type: Optional }] }
    ]; };
    ScriptLoaderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ScriptLoaderService_Factory() { return new ScriptLoaderService(i0.ɵɵinject(i0.NgZone), i0.ɵɵinject(i0.LOCALE_ID), i0.ɵɵinject(i1.GOOGLE_CHARTS_CONFIG, 8)); }, token: ScriptLoaderService, providedIn: "root" });
    ScriptLoaderService = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(1, Inject(LOCALE_ID)),
        __param(2, Inject(GOOGLE_CHARTS_CONFIG)), __param(2, Optional()),
        __metadata("design:paramtypes", [NgZone, String, Object])
    ], ScriptLoaderService);
    return ScriptLoaderService;
}());
export { ScriptLoaderService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LWxvYWRlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1nb29nbGUtY2hhcnRzLyIsInNvdXJjZXMiOlsibGliL3NjcmlwdC1sb2FkZXIvc2NyaXB0LWxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRixPQUFPLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7QUFFeEUsSUFBTSxjQUFjLEdBQXVCO0lBQ3pDLFVBQVUsRUFBRSxFQUFFO0lBQ2QsT0FBTyxFQUFFLFNBQVM7SUFDbEIsUUFBUSxFQUFFLEtBQUs7Q0FDaEIsQ0FBQztBQUdGO0lBSUUsNkJBQ1UsSUFBWSxFQUNPLFFBQWdCLEVBQ08sTUFBMkI7UUFGckUsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNPLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDTyxXQUFNLEdBQU4sTUFBTSxDQUFxQjtRQU45RCxpQkFBWSxHQUFHLDBDQUEwQyxDQUFDO1FBQzFELHNCQUFpQixHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFPdkQsSUFBSSxDQUFDLE1BQU0seUJBQVEsY0FBYyxHQUFLLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFFLENBQUM7SUFDekQsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNJLHFEQUF1QixHQUE5QjtRQUNFLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE9BQU8sTUFBTSxDQUFDLE1BQU0sS0FBSyxXQUFXLEVBQUU7WUFDekUsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVE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LGlCQUFpQixDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUMvQixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNwQixRQUFRLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7O2dCQXBHZSxNQUFNOzZDQUNuQixNQUFNLFNBQUMsU0FBUztnREFDaEIsTUFBTSxTQUFDLG9CQUFvQixjQUFHLFFBQVE7OztJQVA5QixtQkFBbUI7UUFEL0IsVUFBVSxDQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDO1FBTzlCLFdBQUEsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ2pCLFdBQUEsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUEsRUFBRSxXQUFBLFFBQVEsRUFBRSxDQUFBO3lDQUYzQixNQUFNO09BTFgsbUJBQW1CLENBMEcvQjs4QkF4SEQ7Q0F3SEMsQUExR0QsSUEwR0M7U0ExR1ksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBMT0NBTEVfSUQsIE5nWm9uZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IEdvb2dsZUNoYXJ0c0NvbmZpZyB9IGZyb20gJy4uL21vZGVscy9nb29nbGUtY2hhcnRzLWNvbmZpZy5tb2RlbCc7XG5pbXBvcnQgeyBHT09HTEVfQ0hBUlRTX0NPTkZJRyB9IGZyb20gJy4uL21vZGVscy9pbmplY3Rpb24tdG9rZW5zLm1vZGVsJztcblxuY29uc3QgREVGQVVMVF9DT05GSUc6IEdvb2dsZUNoYXJ0c0NvbmZpZyA9IHtcbiAgbWFwc0FwaUtleTogJycsXG4gIHZlcnNpb246ICdjdXJyZW50JyxcbiAgc2FmZU1vZGU6IGZhbHNlXG59O1xuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIFNjcmlwdExvYWRlclNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IHNjcmlwdFNvdXJjZSA9ICdodHRwczovL3d3dy5nc3RhdGljLmNvbS9jaGFydHMvbG9hZGVyLmpzJztcbiAgcHJpdmF0ZSByZWFkb25seSBzY3JpcHRMb2FkU3ViamVjdCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcbiAgICBASW5qZWN0KEdPT0dMRV9DSEFSVFNfQ09ORklHKSBAT3B0aW9uYWwoKSBwcml2YXRlIGNvbmZpZz86IEdvb2dsZUNoYXJ0c0NvbmZpZ1xuICApIHtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLihjb25maWcgfHwge30pIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIHdoZXRoZXIgYGdvb2dsZS5jaGFydHNgIGlzIGF2YWlsYWJsZS5cbiAgICpcbiAgICogSWYgbm90LCBpdCBjYW4gYmUgbG9hZGVkIGJ5IGNhbGxpbmcgYGxvYWRDaGFydFBhY2thZ2VzYC5cbiAgICpcbiAgICogQHJldHVybnMgYHRydWVgIGlmIGBnb29nbGUuY2hhcnRzYCBpcyBhdmFpbGFibGUsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHVibGljIGlzR29vZ2xlQ2hhcnRzQXZhaWxhYmxlKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0eXBlb2YgZ29vZ2xlID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgZ29vZ2xlLmNoYXJ0cyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkcyB0aGUgR29vZ2xlIENoYXJ0IHNjcmlwdCBhbmQgdGhlIHByb3ZpZGVkIGNoYXJ0IHBhY2thZ2VzLlxuICAgKiBDYW4gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIHRvIGxvYWQgbW9yZSBwYWNrYWdlcy5cbiAgICpcbiAgICogV2hlbiBjYWxsZWQgd2l0aG91dCBhbnkgYXJndW1lbnRzLCB0aGlzIHdpbGwganVzdCBsb2FkIHRoZSBkZWZhdWx0IHBhY2thZ2VcbiAgICogY29udGFpbmluZyB0aGUgbmFtZXNwYWNlcyBgZ29vZ2xlLmNoYXJ0c2AgYW5kIGBnb29nbGUudmlzdWFsaXphdGlvbmAgd2l0aG91dCBhbnkgY2hhcnRzLlxuICAgKlxuICAgKiBAcGFyYW0gcGFja2FnZXMgVGhlIHBhY2thZ2VzIHRvIGxvYWQuXG4gICAqIEByZXR1cm5zIEEgc3RyZWFtIGVtaXR0aW5nIGFzIHNvb24gYXMgdGhlIGNoYXJ0IHBhY2thZ2VzIGFyZSBsb2FkZWQuXG4gICAqL1xuICBwdWJsaWMgbG9hZENoYXJ0UGFja2FnZXMoLi4ucGFja2FnZXM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMubG9hZEdvb2dsZUNoYXJ0cygpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGU8dm9pZD4ob2JzZXJ2ZXIgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHBhY2thZ2VzLFxuICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMubG9jYWxlSWQsXG4gICAgICAgICAgICBtYXBzQXBpS2V5OiB0aGlzLmNvbmZpZy5tYXBzQXBpS2V5LFxuICAgICAgICAgICAgc2FmZU1vZGU6IHRoaXMuY29uZmlnLnNhZmVNb2RlXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGdvb2dsZS5jaGFydHMubG9hZCh0aGlzLmNvbmZpZy52ZXJzaW9uLCBjb25maWcpO1xuICAgICAgICAgIGdvb2dsZS5jaGFydHMuc2V0T25Mb2FkQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoKTtcbiAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkcyB0aGUgR29vZ2xlIENoYXJ0cyBzY3JpcHQuIEFmdGVyIHRoZSBzY3JpcHQgaXMgbG9hZGVkLCBgZ29vZ2xlLmNoYXJ0c2AgaXMgZGVmaW5lZC5cbiAgICpcbiAgICogQHJldHVybnMgQSBzdHJlYW0gZW1pdHRpbmcgYXMgc29vbiBhcyBsb2FkaW5nIGhhcyBjb21wbGV0ZWQuXG4gICAqIElmIHRoZSBnb29nbGUgY2hhcnRzIHNjcmlwdCBpcyBhbHJlYWR5IGxvYWRlZCwgdGhlIHN0cmVhbSBlbWl0cyBpbW1lZGlhdGVseS5cbiAgICovXG4gIHByaXZhdGUgbG9hZEdvb2dsZUNoYXJ0cygpIHtcbiAgICBpZiAodGhpcy5pc0dvb2dsZUNoYXJ0c0F2YWlsYWJsZSgpKSB7XG4gICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgfSBlbHNlIGlmICghdGhpcy5pc0xvYWRpbmdHb29nbGVDaGFydHMoKSkge1xuICAgICAgY29uc3Qgc2NyaXB0ID0gdGhpcy5jcmVhdGVHb29nbGVDaGFydHNTY3JpcHQoKTtcbiAgICAgIHNjcmlwdC5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2NyaXB0TG9hZFN1YmplY3QubmV4dCgpO1xuICAgICAgICAgIHRoaXMuc2NyaXB0TG9hZFN1YmplY3QuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBzY3JpcHQub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgdGhlIGdvb2dsZSBjaGFydHMgc2NyaXB0IScpO1xuICAgICAgICAgIHRoaXMuc2NyaXB0TG9hZFN1YmplY3QuZXJyb3IobmV3IEVycm9yKCdGYWlsZWQgdG8gbG9hZCB0aGUgZ29vZ2xlIGNoYXJ0cyBzY3JpcHQhJykpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2NyaXB0TG9hZFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwcml2YXRlIGlzTG9hZGluZ0dvb2dsZUNoYXJ0cygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRHb29nbGVDaGFydHNTY3JpcHQoKSAhPSBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRHb29nbGVDaGFydHNTY3JpcHQoKTogSFRNTFNjcmlwdEVsZW1lbnQgfCBudWxsIHtcbiAgICBjb25zdCBwYWdlU2NyaXB0cyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpKTtcbiAgICByZXR1cm4gcGFnZVNjcmlwdHMuZmluZChzY3JpcHQgPT4gc2NyaXB0LnNyYyA9PT0gdGhpcy5zY3JpcHRTb3VyY2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVHb29nbGVDaGFydHNTY3JpcHQoKTogSFRNTFNjcmlwdEVsZW1lbnQge1xuICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgc2NyaXB0LnNyYyA9IHRoaXMuc2NyaXB0U291cmNlO1xuICAgIHNjcmlwdC5hc3luYyA9IHRydWU7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgIHJldHVybiBzY3JpcHQ7XG4gIH1cbn1cbiJdfQ==