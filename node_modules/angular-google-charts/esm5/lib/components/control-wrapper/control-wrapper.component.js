import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { generateRandomId } from '../../helpers/id.helper';
import { FilterType } from '../../models/control-type.model';
import { ScriptLoaderService } from '../../script-loader/script-loader.service';
var ControlWrapperComponent = /** @class */ (function () {
    function ControlWrapperComponent(loaderService) {
        this.loaderService = loaderService;
        /**
         * Emits when an error occurs when attempting to render the control.
         */
        this.error = new EventEmitter();
        /**
         * The control is ready to accept user interaction and for external method calls.
         *
         * Alternatively, you can listen for a ready event on the dashboard holding the control
         * and call control methods only after the event was fired.
         */
        this.ready = new EventEmitter();
        /**
         * Emits when the user interacts with the control, affecting its state.
         * For example, a `stateChange` event will be emitted whenever you move the thumbs of a range slider control.
         *
         * To retrieve an updated control state after the event fired, call `ControlWrapper.getState()`.
         */
        this.stateChange = new EventEmitter();
        /**
         * A generated id assigned to this components DOM element.
         */
        this.id = generateRandomId();
        this.wrapperReadySubject = new ReplaySubject(1);
        this.initialized = false;
    }
    Object.defineProperty(ControlWrapperComponent.prototype, "wrapperReady$", {
        /**
         * Emits after the `ControlWrapper` was created.
         */
        get: function () {
            return this.wrapperReadySubject.asObservable();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ControlWrapperComponent.prototype, "controlWrapper", {
        get: function () {
            return this._controlWrapper;
        },
        enumerable: true,
        configurable: true
    });
    ControlWrapperComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.loaderService.loadChartPackages('controls').subscribe(function () {
            _this.createControlWrapper();
            _this.initialized = true;
        });
    };
    ControlWrapperComponent.prototype.ngOnChanges = function (changes) {
        if (!this.initialized) {
            return;
        }
        if (changes.type) {
            this._controlWrapper.setControlType(this.type);
        }
        if (changes.options) {
            this._controlWrapper.setOptions(this.options);
        }
        if (changes.state) {
            this._controlWrapper.setState(this.state);
        }
    };
    ControlWrapperComponent.prototype.createControlWrapper = function () {
        this._controlWrapper = new google.visualization.ControlWrapper({
            containerId: this.id,
            controlType: this.type,
            state: this.state,
            options: this.options
        });
        this.addEventListeners();
        this.wrapperReadySubject.next(this._controlWrapper);
    };
    ControlWrapperComponent.prototype.addEventListeners = function () {
        var _this = this;
        google.visualization.events.removeAllListeners(this._controlWrapper);
        google.visualization.events.addListener(this._controlWrapper, 'ready', function (event) { return _this.ready.emit(event); });
        google.visualization.events.addListener(this._controlWrapper, 'error', function (event) { return _this.error.emit(event); });
        google.visualization.events.addListener(this._controlWrapper, 'statechange', function (event) { return _this.stateChange.emit(event); });
    };
    ControlWrapperComponent.ctorParameters = function () { return [
        { type: ScriptLoaderService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "for", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], ControlWrapperComponent.prototype, "type", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "options", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "state", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "error", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "ready", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "stateChange", void 0);
    __decorate([
        HostBinding('id'),
        __metadata("design:type", Object)
    ], ControlWrapperComponent.prototype, "id", void 0);
    ControlWrapperComponent = __decorate([
        Component({
            selector: 'control-wrapper',
            template: '',
            host: { class: 'control-wrapper' },
            exportAs: 'controlWrapper',
            changeDetection: ChangeDetectionStrategy.OnPush
        }),
        __metadata("design:paramtypes", [ScriptLoaderService])
    ], ControlWrapperComponent);
    return ControlWrapperComponent;
}());
export { ControlWrapperComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC13cmFwcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItZ29vZ2xlLWNoYXJ0cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnRyb2wtd3JhcHBlci9jb250cm9sLXdyYXBwZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFHTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVyQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFN0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFVaEY7SUFvRkUsaUNBQW9CLGFBQWtDO1FBQWxDLGtCQUFhLEdBQWIsYUFBYSxDQUFxQjtRQWxDdEQ7O1dBRUc7UUFFSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFFbkQ7Ozs7O1dBS0c7UUFFSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUV4Qzs7Ozs7V0FLRztRQUVJLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUU5Qzs7V0FFRztRQUVhLE9BQUUsR0FBRyxnQkFBZ0IsRUFBRSxDQUFDO1FBR2hDLHdCQUFtQixHQUFHLElBQUksYUFBYSxDQUFzQyxDQUFDLENBQUMsQ0FBQztRQUNoRixnQkFBVyxHQUFHLEtBQUssQ0FBQztJQUU2QixDQUFDO0lBSzFELHNCQUFXLGtEQUFhO1FBSHhCOztXQUVHO2FBQ0g7WUFDRSxPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNqRCxDQUFDOzs7T0FBQTtJQUVELHNCQUFXLG1EQUFjO2FBQXpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQzlCLENBQUM7OztPQUFBO0lBRU0sMENBQVEsR0FBZjtRQUFBLGlCQUtDO1FBSkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDekQsS0FBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDNUIsS0FBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sNkNBQVcsR0FBbEIsVUFBbUIsT0FBc0I7UUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDckIsT0FBTztTQUNSO1FBRUQsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoRDtRQUVELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUNuQixJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDL0M7UUFFRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDakIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztJQUVPLHNEQUFvQixHQUE1QjtRQUNFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQztZQUM3RCxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDcEIsV0FBVyxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ3RCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztZQUNqQixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87U0FDdEIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVPLG1EQUFpQixHQUF6QjtRQUFBLGlCQU1DO1FBTEMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBRXJFLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLE9BQU8sRUFBRSxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUF0QixDQUFzQixDQUFDLENBQUM7UUFDeEcsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsT0FBTyxFQUFFLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQXRCLENBQXNCLENBQUMsQ0FBQztRQUN4RyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxhQUFhLEVBQUUsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBNUIsQ0FBNEIsQ0FBQyxDQUFDO0lBQ3RILENBQUM7O2dCQXhEa0MsbUJBQW1COztJQS9FdEQ7UUFEQyxLQUFLLEVBQUU7O3dEQUM2QjtJQWFyQztRQURDLEtBQUssRUFBRTs7eURBQ2lCO0lBYXpCO1FBREMsS0FBSyxFQUFFOzs0REFDZ0I7SUFpQnhCO1FBREMsS0FBSyxFQUFFOzswREFDYztJQU10QjtRQURDLE1BQU0sRUFBRTs7MERBQzBDO0lBU25EO1FBREMsTUFBTSxFQUFFOzswREFDK0I7SUFTeEM7UUFEQyxNQUFNLEVBQUU7O2dFQUNxQztJQU05QztRQURDLFdBQVcsQ0FBQyxJQUFJLENBQUM7O3VEQUNzQjtJQTlFN0IsdUJBQXVCO1FBUG5DLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxpQkFBaUI7WUFDM0IsUUFBUSxFQUFFLEVBQUU7WUFDWixJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7WUFDbEMsUUFBUSxFQUFFLGdCQUFnQjtZQUMxQixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtTQUNoRCxDQUFDO3lDQXFGbUMsbUJBQW1CO09BcEYzQyx1QkFBdUIsQ0E2SW5DO0lBQUQsOEJBQUM7Q0FBQSxBQTdJRCxJQTZJQztTQTdJWSx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgZ2VuZXJhdGVSYW5kb21JZCB9IGZyb20gJy4uLy4uL2hlbHBlcnMvaWQuaGVscGVyJztcbmltcG9ydCB7IEZpbHRlclR5cGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvY29udHJvbC10eXBlLm1vZGVsJztcbmltcG9ydCB7IENoYXJ0RXJyb3JFdmVudCB9IGZyb20gJy4uLy4uL21vZGVscy9ldmVudHMubW9kZWwnO1xuaW1wb3J0IHsgU2NyaXB0TG9hZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NjcmlwdC1sb2FkZXIvc2NyaXB0LWxvYWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IENoYXJ0QmFzZSB9IGZyb20gJy4uL2NoYXJ0LWJhc2UvY2hhcnQtYmFzZS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjb250cm9sLXdyYXBwZXInLFxuICB0ZW1wbGF0ZTogJycsXG4gIGhvc3Q6IHsgY2xhc3M6ICdjb250cm9sLXdyYXBwZXInIH0sXG4gIGV4cG9ydEFzOiAnY29udHJvbFdyYXBwZXInLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBDb250cm9sV3JhcHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgLyoqXG4gICAqIENoYXJ0cyBjb250cm9sbGVkIGJ5IHRoaXMgY29udHJvbCB3cmFwcGVyLiBDYW4gYmUgYSBzaW5nbGUgY2hhcnQgb3IgYW4gYXJyYXkgb2YgY2hhcnRzLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIGZvciE6IENoYXJ0QmFzZSB8IENoYXJ0QmFzZVtdO1xuXG4gIC8qKlxuICAgKiBUaGUgY2xhc3MgbmFtZSBvZiB0aGUgY29udHJvbC5cbiAgICogVGhlIGBnb29nbGUudmlzdWFsaXphdGlvbmAgcGFja2FnZSBuYW1lIGNhbiBiZSBvbWl0dGVkIGZvciBHb29nbGUgY29udHJvbHMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGBgYGh0bWxcbiAgICogPGNvbnRyb2wtd3JhcHBlciB0eXBlPVwiQ2F0ZWdvcnlGaWx0ZXJcIj48L2NvbnRyb2wtd3JhcHBlcj5cbiAgICogYGBgXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgdHlwZSE6IEZpbHRlclR5cGU7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBkZXNjcmliaW5nIHRoZSBvcHRpb25zIGZvciB0aGUgY29udHJvbC5cbiAgICogWW91IGNhbiB1c2UgZWl0aGVyIEphdmFTY3JpcHQgbGl0ZXJhbCBub3RhdGlvbiwgb3IgcHJvdmlkZSBhIGhhbmRsZSB0byB0aGUgb2JqZWN0LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBgYGBodG1sXG4gICAqIDxjb250cm9sLXdyYXBwZXIgW29wdGlvbnNdPVwieydmaWx0ZXJDb2x1bW5MYWJlbCc6ICdBZ2UnLCAnbWluVmFsdWUnOiAxMCwgJ21heFZhbHVlJzogODB9XCI+PC9jb250cm9sLXdyYXBwZXI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIG9wdGlvbnM/OiBvYmplY3Q7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgY29udHJvbC5cbiAgICogVGhlIHN0YXRlIGNvbGxlY3RzIGFsbCB0aGUgdmFyaWFibGVzIHRoYXQgdGhlIHVzZXIgb3BlcmF0aW5nIHRoZSBjb250cm9sIGNhbiBhZmZlY3QuXG4gICAqXG4gICAqIEZvciBleGFtcGxlLCBhIHJhbmdlIHNsaWRlciBzdGF0ZSBjYW4gYmUgZGVzY3JpYmVkIGluIHRlcm0gb2YgdGhlIHBvc2l0aW9ucyB0aGF0IHRoZSBsb3cgYW5kIGhpZ2ggdGh1bWJcbiAgICogb2YgdGhlIHNsaWRlciBvY2N1cHkuXG4gICAqIFlvdSBjYW4gdXNlIGVpdGhlciBKYXZhc2NyaXB0IGxpdGVyYWwgbm90YXRpb24sIG9yIHByb3ZpZGUgYSBoYW5kbGUgdG8gdGhlIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogIGBgYGh0bWxcbiAgICogPGNvbnRyb2wtd3JhcHBlciBbc3RhdGVdPVwieydsb3dWYWx1ZSc6IDIwLCAnaGlnaFZhbHVlJzogNTB9XCI+PC9jb250cm9sLXdyYXBwZXI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHN0YXRlPzogb2JqZWN0O1xuXG4gIC8qKlxuICAgKiBFbWl0cyB3aGVuIGFuIGVycm9yIG9jY3VycyB3aGVuIGF0dGVtcHRpbmcgdG8gcmVuZGVyIHRoZSBjb250cm9sLlxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8Q2hhcnRFcnJvckV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBUaGUgY29udHJvbCBpcyByZWFkeSB0byBhY2NlcHQgdXNlciBpbnRlcmFjdGlvbiBhbmQgZm9yIGV4dGVybmFsIG1ldGhvZCBjYWxscy5cbiAgICpcbiAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBsaXN0ZW4gZm9yIGEgcmVhZHkgZXZlbnQgb24gdGhlIGRhc2hib2FyZCBob2xkaW5nIHRoZSBjb250cm9sXG4gICAqIGFuZCBjYWxsIGNvbnRyb2wgbWV0aG9kcyBvbmx5IGFmdGVyIHRoZSBldmVudCB3YXMgZmlyZWQuXG4gICAqL1xuICBAT3V0cHV0KClcbiAgcHVibGljIHJlYWR5ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIC8qKlxuICAgKiBFbWl0cyB3aGVuIHRoZSB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBjb250cm9sLCBhZmZlY3RpbmcgaXRzIHN0YXRlLlxuICAgKiBGb3IgZXhhbXBsZSwgYSBgc3RhdGVDaGFuZ2VgIGV2ZW50IHdpbGwgYmUgZW1pdHRlZCB3aGVuZXZlciB5b3UgbW92ZSB0aGUgdGh1bWJzIG9mIGEgcmFuZ2Ugc2xpZGVyIGNvbnRyb2wuXG4gICAqXG4gICAqIFRvIHJldHJpZXZlIGFuIHVwZGF0ZWQgY29udHJvbCBzdGF0ZSBhZnRlciB0aGUgZXZlbnQgZmlyZWQsIGNhbGwgYENvbnRyb2xXcmFwcGVyLmdldFN0YXRlKClgLlxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyBzdGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogQSBnZW5lcmF0ZWQgaWQgYXNzaWduZWQgdG8gdGhpcyBjb21wb25lbnRzIERPTSBlbGVtZW50LlxuICAgKi9cbiAgQEhvc3RCaW5kaW5nKCdpZCcpXG4gIHB1YmxpYyByZWFkb25seSBpZCA9IGdlbmVyYXRlUmFuZG9tSWQoKTtcblxuICBwcml2YXRlIF9jb250cm9sV3JhcHBlcjogZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29udHJvbFdyYXBwZXI7XG4gIHByaXZhdGUgd3JhcHBlclJlYWR5U3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyPigxKTtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9hZGVyU2VydmljZTogU2NyaXB0TG9hZGVyU2VydmljZSkge31cblxuICAvKipcbiAgICogRW1pdHMgYWZ0ZXIgdGhlIGBDb250cm9sV3JhcHBlcmAgd2FzIGNyZWF0ZWQuXG4gICAqL1xuICBwdWJsaWMgZ2V0IHdyYXBwZXJSZWFkeSQoKSB7XG4gICAgcmV0dXJuIHRoaXMud3JhcHBlclJlYWR5U3ViamVjdC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY29udHJvbFdyYXBwZXIoKTogZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29udHJvbFdyYXBwZXIgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5fY29udHJvbFdyYXBwZXI7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5sb2FkZXJTZXJ2aWNlLmxvYWRDaGFydFBhY2thZ2VzKCdjb250cm9scycpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZUNvbnRyb2xXcmFwcGVyKCk7XG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMudHlwZSkge1xuICAgICAgdGhpcy5fY29udHJvbFdyYXBwZXIuc2V0Q29udHJvbFR5cGUodGhpcy50eXBlKTtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlcy5vcHRpb25zKSB7XG4gICAgICB0aGlzLl9jb250cm9sV3JhcHBlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMuc3RhdGUpIHtcbiAgICAgIHRoaXMuX2NvbnRyb2xXcmFwcGVyLnNldFN0YXRlKHRoaXMuc3RhdGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ29udHJvbFdyYXBwZXIoKSB7XG4gICAgdGhpcy5fY29udHJvbFdyYXBwZXIgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29udHJvbFdyYXBwZXIoe1xuICAgICAgY29udGFpbmVySWQ6IHRoaXMuaWQsXG4gICAgICBjb250cm9sVHlwZTogdGhpcy50eXBlLFxuICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICBvcHRpb25zOiB0aGlzLm9wdGlvbnNcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLndyYXBwZXJSZWFkeVN1YmplY3QubmV4dCh0aGlzLl9jb250cm9sV3JhcHBlcik7XG4gIH1cblxuICBwcml2YXRlIGFkZEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy5fY29udHJvbFdyYXBwZXIpO1xuXG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMuX2NvbnRyb2xXcmFwcGVyLCAncmVhZHknLCBldmVudCA9PiB0aGlzLnJlYWR5LmVtaXQoZXZlbnQpKTtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIodGhpcy5fY29udHJvbFdyYXBwZXIsICdlcnJvcicsIGV2ZW50ID0+IHRoaXMuZXJyb3IuZW1pdChldmVudCkpO1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcih0aGlzLl9jb250cm9sV3JhcHBlciwgJ3N0YXRlY2hhbmdlJywgZXZlbnQgPT4gdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KGV2ZW50KSk7XG4gIH1cbn1cbiJdfQ==