import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { generateRandomId } from '../../helpers/id.helper';
import { FilterType } from '../../models/control-type.model';
import { ScriptLoaderService } from '../../script-loader/script-loader.service';
let ControlWrapperComponent = class ControlWrapperComponent {
    constructor(loaderService) {
        this.loaderService = loaderService;
        /**
         * Emits when an error occurs when attempting to render the control.
         */
        this.error = new EventEmitter();
        /**
         * The control is ready to accept user interaction and for external method calls.
         *
         * Alternatively, you can listen for a ready event on the dashboard holding the control
         * and call control methods only after the event was fired.
         */
        this.ready = new EventEmitter();
        /**
         * Emits when the user interacts with the control, affecting its state.
         * For example, a `stateChange` event will be emitted whenever you move the thumbs of a range slider control.
         *
         * To retrieve an updated control state after the event fired, call `ControlWrapper.getState()`.
         */
        this.stateChange = new EventEmitter();
        /**
         * A generated id assigned to this components DOM element.
         */
        this.id = generateRandomId();
        this.wrapperReadySubject = new ReplaySubject(1);
        this.initialized = false;
    }
    /**
     * Emits after the `ControlWrapper` was created.
     */
    get wrapperReady$() {
        return this.wrapperReadySubject.asObservable();
    }
    get controlWrapper() {
        return this._controlWrapper;
    }
    ngOnInit() {
        this.loaderService.loadChartPackages('controls').subscribe(() => {
            this.createControlWrapper();
            this.initialized = true;
        });
    }
    ngOnChanges(changes) {
        if (!this.initialized) {
            return;
        }
        if (changes.type) {
            this._controlWrapper.setControlType(this.type);
        }
        if (changes.options) {
            this._controlWrapper.setOptions(this.options);
        }
        if (changes.state) {
            this._controlWrapper.setState(this.state);
        }
    }
    createControlWrapper() {
        this._controlWrapper = new google.visualization.ControlWrapper({
            containerId: this.id,
            controlType: this.type,
            state: this.state,
            options: this.options
        });
        this.addEventListeners();
        this.wrapperReadySubject.next(this._controlWrapper);
    }
    addEventListeners() {
        google.visualization.events.removeAllListeners(this._controlWrapper);
        google.visualization.events.addListener(this._controlWrapper, 'ready', event => this.ready.emit(event));
        google.visualization.events.addListener(this._controlWrapper, 'error', event => this.error.emit(event));
        google.visualization.events.addListener(this._controlWrapper, 'statechange', event => this.stateChange.emit(event));
    }
};
ControlWrapperComponent.ctorParameters = () => [
    { type: ScriptLoaderService }
];
__decorate([
    Input(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "for", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], ControlWrapperComponent.prototype, "type", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "options", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "state", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "error", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "ready", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "stateChange", void 0);
__decorate([
    HostBinding('id'),
    __metadata("design:type", Object)
], ControlWrapperComponent.prototype, "id", void 0);
ControlWrapperComponent = __decorate([
    Component({
        selector: 'control-wrapper',
        template: '',
        host: { class: 'control-wrapper' },
        exportAs: 'controlWrapper',
        changeDetection: ChangeDetectionStrategy.OnPush
    }),
    __metadata("design:paramtypes", [ScriptLoaderService])
], ControlWrapperComponent);
export { ControlWrapperComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC13cmFwcGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItZ29vZ2xlLWNoYXJ0cy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnRyb2wtd3JhcHBlci9jb250cm9sLXdyYXBwZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFHTCxNQUFNLEVBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVyQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFN0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFVaEYsSUFBYSx1QkFBdUIsR0FBcEMsTUFBYSx1QkFBdUI7SUFvRmxDLFlBQW9CLGFBQWtDO1FBQWxDLGtCQUFhLEdBQWIsYUFBYSxDQUFxQjtRQWxDdEQ7O1dBRUc7UUFFSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFFbkQ7Ozs7O1dBS0c7UUFFSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUV4Qzs7Ozs7V0FLRztRQUVJLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUU5Qzs7V0FFRztRQUVhLE9BQUUsR0FBRyxnQkFBZ0IsRUFBRSxDQUFDO1FBR2hDLHdCQUFtQixHQUFHLElBQUksYUFBYSxDQUFzQyxDQUFDLENBQUMsQ0FBQztRQUNoRixnQkFBVyxHQUFHLEtBQUssQ0FBQztJQUU2QixDQUFDO0lBRTFEOztPQUVHO0lBQ0gsSUFBVyxhQUFhO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxDQUFDO0lB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QixRQUFRLEVBQUUsRUFBRTtRQUNaLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRTtRQUNsQyxRQUFRLEVBQUUsZ0JBQWdCO1FBQzFCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO0tBQ2hELENBQUM7cUNBcUZtQyxtQkFBbUI7R0FwRjNDLHVCQUF1QixDQTZJbkM7U0E3SVksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IGdlbmVyYXRlUmFuZG9tSWQgfSBmcm9tICcuLi8uLi9oZWxwZXJzL2lkLmhlbHBlcic7XG5pbXBvcnQgeyBGaWx0ZXJUeXBlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2NvbnRyb2wtdHlwZS5tb2RlbCc7XG5pbXBvcnQgeyBDaGFydEVycm9yRXZlbnQgfSBmcm9tICcuLi8uLi9tb2RlbHMvZXZlbnRzLm1vZGVsJztcbmltcG9ydCB7IFNjcmlwdExvYWRlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zY3JpcHQtbG9hZGVyL3NjcmlwdC1sb2FkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBDaGFydEJhc2UgfSBmcm9tICcuLi9jaGFydC1iYXNlL2NoYXJ0LWJhc2UuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY29udHJvbC13cmFwcGVyJyxcbiAgdGVtcGxhdGU6ICcnLFxuICBob3N0OiB7IGNsYXNzOiAnY29udHJvbC13cmFwcGVyJyB9LFxuICBleHBvcnRBczogJ2NvbnRyb2xXcmFwcGVyJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgQ29udHJvbFdyYXBwZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIC8qKlxuICAgKiBDaGFydHMgY29udHJvbGxlZCBieSB0aGlzIGNvbnRyb2wgd3JhcHBlci4gQ2FuIGJlIGEgc2luZ2xlIGNoYXJ0IG9yIGFuIGFycmF5IG9mIGNoYXJ0cy5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBmb3IhOiBDaGFydEJhc2UgfCBDaGFydEJhc2VbXTtcblxuICAvKipcbiAgICogVGhlIGNsYXNzIG5hbWUgb2YgdGhlIGNvbnRyb2wuXG4gICAqIFRoZSBgZ29vZ2xlLnZpc3VhbGl6YXRpb25gIHBhY2thZ2UgbmFtZSBjYW4gYmUgb21pdHRlZCBmb3IgR29vZ2xlIGNvbnRyb2xzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBgYGBodG1sXG4gICAqIDxjb250cm9sLXdyYXBwZXIgdHlwZT1cIkNhdGVnb3J5RmlsdGVyXCI+PC9jb250cm9sLXdyYXBwZXI+XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHR5cGUhOiBGaWx0ZXJUeXBlO1xuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgZGVzY3JpYmluZyB0aGUgb3B0aW9ucyBmb3IgdGhlIGNvbnRyb2wuXG4gICAqIFlvdSBjYW4gdXNlIGVpdGhlciBKYXZhU2NyaXB0IGxpdGVyYWwgbm90YXRpb24sIG9yIHByb3ZpZGUgYSBoYW5kbGUgdG8gdGhlIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogYGBgaHRtbFxuICAgKiA8Y29udHJvbC13cmFwcGVyIFtvcHRpb25zXT1cInsnZmlsdGVyQ29sdW1uTGFiZWwnOiAnQWdlJywgJ21pblZhbHVlJzogMTAsICdtYXhWYWx1ZSc6IDgwfVwiPjwvY29udHJvbC13cmFwcGVyPlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBvcHRpb25zPzogb2JqZWN0O1xuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgZGVzY3JpYmluZyB0aGUgc3RhdGUgb2YgdGhlIGNvbnRyb2wuXG4gICAqIFRoZSBzdGF0ZSBjb2xsZWN0cyBhbGwgdGhlIHZhcmlhYmxlcyB0aGF0IHRoZSB1c2VyIG9wZXJhdGluZyB0aGUgY29udHJvbCBjYW4gYWZmZWN0LlxuICAgKlxuICAgKiBGb3IgZXhhbXBsZSwgYSByYW5nZSBzbGlkZXIgc3RhdGUgY2FuIGJlIGRlc2NyaWJlZCBpbiB0ZXJtIG9mIHRoZSBwb3NpdGlvbnMgdGhhdCB0aGUgbG93IGFuZCBoaWdoIHRodW1iXG4gICAqIG9mIHRoZSBzbGlkZXIgb2NjdXB5LlxuICAgKiBZb3UgY2FuIHVzZSBlaXRoZXIgSmF2YXNjcmlwdCBsaXRlcmFsIG5vdGF0aW9uLCBvciBwcm92aWRlIGEgaGFuZGxlIHRvIHRoZSBvYmplY3QuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqICBgYGBodG1sXG4gICAqIDxjb250cm9sLXdyYXBwZXIgW3N0YXRlXT1cInsnbG93VmFsdWUnOiAyMCwgJ2hpZ2hWYWx1ZSc6IDUwfVwiPjwvY29udHJvbC13cmFwcGVyPlxuICAgKiBgYGBcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzdGF0ZT86IG9iamVjdDtcblxuICAvKipcbiAgICogRW1pdHMgd2hlbiBhbiBlcnJvciBvY2N1cnMgd2hlbiBhdHRlbXB0aW5nIHRvIHJlbmRlciB0aGUgY29udHJvbC5cbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPENoYXJ0RXJyb3JFdmVudD4oKTtcblxuICAvKipcbiAgICogVGhlIGNvbnRyb2wgaXMgcmVhZHkgdG8gYWNjZXB0IHVzZXIgaW50ZXJhY3Rpb24gYW5kIGZvciBleHRlcm5hbCBtZXRob2QgY2FsbHMuXG4gICAqXG4gICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gbGlzdGVuIGZvciBhIHJlYWR5IGV2ZW50IG9uIHRoZSBkYXNoYm9hcmQgaG9sZGluZyB0aGUgY29udHJvbFxuICAgKiBhbmQgY2FsbCBjb250cm9sIG1ldGhvZHMgb25seSBhZnRlciB0aGUgZXZlbnQgd2FzIGZpcmVkLlxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyByZWFkeSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogRW1pdHMgd2hlbiB0aGUgdXNlciBpbnRlcmFjdHMgd2l0aCB0aGUgY29udHJvbCwgYWZmZWN0aW5nIGl0cyBzdGF0ZS5cbiAgICogRm9yIGV4YW1wbGUsIGEgYHN0YXRlQ2hhbmdlYCBldmVudCB3aWxsIGJlIGVtaXR0ZWQgd2hlbmV2ZXIgeW91IG1vdmUgdGhlIHRodW1icyBvZiBhIHJhbmdlIHNsaWRlciBjb250cm9sLlxuICAgKlxuICAgKiBUbyByZXRyaWV2ZSBhbiB1cGRhdGVkIGNvbnRyb2wgc3RhdGUgYWZ0ZXIgdGhlIGV2ZW50IGZpcmVkLCBjYWxsIGBDb250cm9sV3JhcHBlci5nZXRTdGF0ZSgpYC5cbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgc3RhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgLyoqXG4gICAqIEEgZ2VuZXJhdGVkIGlkIGFzc2lnbmVkIHRvIHRoaXMgY29tcG9uZW50cyBET00gZWxlbWVudC5cbiAgICovXG4gIEBIb3N0QmluZGluZygnaWQnKVxuICBwdWJsaWMgcmVhZG9ubHkgaWQgPSBnZW5lcmF0ZVJhbmRvbUlkKCk7XG5cbiAgcHJpdmF0ZSBfY29udHJvbFdyYXBwZXI6IGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyO1xuICBwcml2YXRlIHdyYXBwZXJSZWFkeVN1YmplY3QgPSBuZXcgUmVwbGF5U3ViamVjdDxnb29nbGUudmlzdWFsaXphdGlvbi5Db250cm9sV3JhcHBlcj4oMSk7XG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvYWRlclNlcnZpY2U6IFNjcmlwdExvYWRlclNlcnZpY2UpIHt9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFmdGVyIHRoZSBgQ29udHJvbFdyYXBwZXJgIHdhcyBjcmVhdGVkLlxuICAgKi9cbiAgcHVibGljIGdldCB3cmFwcGVyUmVhZHkkKCkge1xuICAgIHJldHVybiB0aGlzLndyYXBwZXJSZWFkeVN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGNvbnRyb2xXcmFwcGVyKCk6IGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRyb2xXcmFwcGVyO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuICAgIHRoaXMubG9hZGVyU2VydmljZS5sb2FkQ2hhcnRQYWNrYWdlcygnY29udHJvbHMnKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5jcmVhdGVDb250cm9sV3JhcHBlcigpO1xuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLnR5cGUpIHtcbiAgICAgIHRoaXMuX2NvbnRyb2xXcmFwcGVyLnNldENvbnRyb2xUeXBlKHRoaXMudHlwZSk7XG4gICAgfVxuXG4gICAgaWYgKGNoYW5nZXMub3B0aW9ucykge1xuICAgICAgdGhpcy5fY29udHJvbFdyYXBwZXIuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzLnN0YXRlKSB7XG4gICAgICB0aGlzLl9jb250cm9sV3JhcHBlci5zZXRTdGF0ZSh0aGlzLnN0YXRlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNvbnRyb2xXcmFwcGVyKCkge1xuICAgIHRoaXMuX2NvbnRyb2xXcmFwcGVyID0gbmV3IGdvb2dsZS52aXN1YWxpemF0aW9uLkNvbnRyb2xXcmFwcGVyKHtcbiAgICAgIGNvbnRhaW5lcklkOiB0aGlzLmlkLFxuICAgICAgY29udHJvbFR5cGU6IHRoaXMudHlwZSxcbiAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgb3B0aW9uczogdGhpcy5vcHRpb25zXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy53cmFwcGVyUmVhZHlTdWJqZWN0Lm5leHQodGhpcy5fY29udHJvbFdyYXBwZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRFdmVudExpc3RlbmVycygpIHtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMucmVtb3ZlQWxsTGlzdGVuZXJzKHRoaXMuX2NvbnRyb2xXcmFwcGVyKTtcblxuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcih0aGlzLl9jb250cm9sV3JhcHBlciwgJ3JlYWR5JywgZXZlbnQgPT4gdGhpcy5yZWFkeS5lbWl0KGV2ZW50KSk7XG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMuX2NvbnRyb2xXcmFwcGVyLCAnZXJyb3InLCBldmVudCA9PiB0aGlzLmVycm9yLmVtaXQoZXZlbnQpKTtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIodGhpcy5fY29udHJvbFdyYXBwZXIsICdzdGF0ZWNoYW5nZScsIGV2ZW50ID0+IHRoaXMuc3RhdGVDaGFuZ2UuZW1pdChldmVudCkpO1xuICB9XG59XG4iXX0=